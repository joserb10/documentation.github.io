<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Construcción</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/documentation.github.io/assets/css/0.styles.d4296b04.css" as="style"><link rel="preload" href="/documentation.github.io/assets/js/app.c9d3f325.js" as="script"><link rel="preload" href="/documentation.github.io/assets/js/2.7e8b5cf7.js" as="script"><link rel="preload" href="/documentation.github.io/assets/js/9.9177e5a5.js" as="script"><link rel="prefetch" href="/documentation.github.io/assets/js/10.96269606.js"><link rel="prefetch" href="/documentation.github.io/assets/js/11.f4ef038d.js"><link rel="prefetch" href="/documentation.github.io/assets/js/12.f3f06b7d.js"><link rel="prefetch" href="/documentation.github.io/assets/js/13.fc21ea81.js"><link rel="prefetch" href="/documentation.github.io/assets/js/14.606673e5.js"><link rel="prefetch" href="/documentation.github.io/assets/js/15.98ea0700.js"><link rel="prefetch" href="/documentation.github.io/assets/js/16.5caa4a71.js"><link rel="prefetch" href="/documentation.github.io/assets/js/17.f3349bf3.js"><link rel="prefetch" href="/documentation.github.io/assets/js/18.b8736fd4.js"><link rel="prefetch" href="/documentation.github.io/assets/js/3.d2fa742c.js"><link rel="prefetch" href="/documentation.github.io/assets/js/4.8e022cfe.js"><link rel="prefetch" href="/documentation.github.io/assets/js/5.6c6f820d.js"><link rel="prefetch" href="/documentation.github.io/assets/js/6.f5002f39.js"><link rel="prefetch" href="/documentation.github.io/assets/js/7.0927b680.js"><link rel="prefetch" href="/documentation.github.io/assets/js/8.a023f38b.js">
    <link rel="stylesheet" href="/documentation.github.io/assets/css/0.styles.d4296b04.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation.github.io/" class="home-link router-link-active"><img src="/documentation.github.io/assets/img/logo_naranja.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/documentation.github.io/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="/documentation.github.io/api/" class="nav-link router-link-active">
  Rest Api
</a></div><div class="nav-item"><a href="/documentation.github.io/frontend/" class="nav-link">
  Frontend
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/documentation.github.io/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="/documentation.github.io/api/" class="nav-link router-link-active">
  Rest Api
</a></div><div class="nav-item"><a href="/documentation.github.io/frontend/" class="nav-link">
  Frontend
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Rest Api</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation.github.io/api/construccion.html" aria-current="page" class="active sidebar-link">Construcción</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#spring-boot" class="sidebar-link">Spring Boot</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#dependencias" class="sidebar-link">Dependencias</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#conexion-a-la-base-de-datos-mysql" class="sidebar-link">Conexión a la base de datos Mysql</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#entidades" class="sidebar-link">Entidades</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#repositorios" class="sidebar-link">Repositorios</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#servicios" class="sidebar-link">Servicios</a></li><li class="sidebar-sub-header"><a href="/documentation.github.io/api/construccion.html#rest-controllers" class="sidebar-link">Rest Controllers</a></li></ul></li><li><a href="/documentation.github.io/api/keep-alive.html" class="sidebar-link">Keep Alive Strategy</a></li><li><a href="/documentation.github.io/api/sql-inyection.html" class="sidebar-link">Prevenir Sql Inyection</a></li><li><a href="/documentation.github.io/api/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/documentation.github.io/api/uso-api.html" class="sidebar-link">Uso de la API</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="construccion"><a href="#construccion" class="header-anchor">#</a> Construcción</h1> <h2 id="spring-boot"><a href="#spring-boot" class="header-anchor">#</a> Spring Boot</h2> <p>Para construir la api se hizo uso del framework de Java Spring Boot, este framework está altamente calificado debido a su rendimiento, seguridad entre otros puntos.</p> <h2 id="dependencias"><a href="#dependencias" class="header-anchor">#</a> Dependencias</h2> <h3 id="spring-data-jpa"><a href="#spring-data-jpa" class="header-anchor">#</a> Spring Data JPA</h3> <p>Se usó Spring Data JPA como dependcia para consumir datos de la base de datos a través de interfaces.</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre></div><h3 id="spring-web"><a href="#spring-web" class="header-anchor">#</a> Spring Web</h3> <p>Se usó Spring Web como soporte para el desarrollo web de api rest.</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre></div><h3 id="mysql-driver"><a href="#mysql-driver" class="header-anchor">#</a> Mysql Driver</h3> <p>Para permitir la conexión a la base de datos en Mysql.</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;dependency&gt;
			&lt;groupId&gt;mysql&lt;/groupId&gt;
			&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
</code></pre></div><h3 id="lombok"><a href="#lombok" class="header-anchor">#</a> Lombok</h3> <p>Se usó lombok para la reducción y optimización de escritura de código gracias a las anotaciones que permiten generar setters, getters, constructores entre otros.</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;dependency&gt;
			&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
			&lt;artifactId&gt;lombok&lt;/artifactId&gt;
			&lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
</code></pre></div><h3 id="spring-boot-cache"><a href="#spring-boot-cache" class="header-anchor">#</a> Spring Boot Cache</h3> <p>Para el cacheado de repositorios y entidades.</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre></div><h2 id="conexion-a-la-base-de-datos-mysql"><a href="#conexion-a-la-base-de-datos-mysql" class="header-anchor">#</a> Conexión a la base de datos Mysql</h2> <p>Para la conexión a la base de datos se remota se hizo uso de la siguiente configuración en aplication.properties. Indicando tanto el servidor, nombre de la base de datos, driver a usar y credenciales de acceso.</p> <div class="language- extra-class"><pre class="language-text"><code>    #Conexion a la base de datos

    #Driver para la conexion
    spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

    #Url host y nombre de la base de datos
    spring.datasource.url=jdbc:mysql://mdb-test.c6vunyturrl6.us-west-1.rds.amazonaws.com/bsale_test

    #Credenciales de la base de datos
    spring.datasource.username=bsale_test
    spring.datasource.password=bsale_test

    #Mostrar queries ejecutadas en la base datos
    spring.jpa.show-sql = true
</code></pre></div><h2 id="entidades"><a href="#entidades" class="header-anchor">#</a> Entidades</h2> <p>La primera entidad generada fue Category, en el cual se indica que el identificador debe ser el campo 'id', y debe generarse automaticamente, así tambien se agregó el campo 'name' tipo String.</p> <div class="language- extra-class"><pre class="language-text"><code>    @Entity
    @Table(name = &quot;category&quot;)
    @Getter @Setter @NoArgsConstructor @AllArgsConstructor
    public class Category {
        @Id
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private int id;
        private String name;
    }
</code></pre></div><p>El segunda entidad es Products la cual debe llevar el foreign key de Category, por lo cual se hace uso de la anotación @ManyToOne en el campo 'category' lo cual quiere decir que una categoría posee muchos productos.</p> <div class="language- extra-class"><pre class="language-text"><code>    @Entity
    @Table(name = &quot;product&quot;)
    @Getter @Setter @NoArgsConstructor @AllArgsConstructor
    public class Product {
        @Id
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private int id;
        private String name;
        private String url_image;
        private float price;
        private int discount;

        @ManyToOne(fetch =FetchType.EAGER)
        @JoinColumn(name=&quot;category&quot;, nullable=true, referencedColumnName = &quot;id&quot;)
        private Category category;
    }
</code></pre></div><h2 id="repositorios"><a href="#repositorios" class="header-anchor">#</a> Repositorios</h2> <p>Para el acceso a la base de datos se generó dos repositorios. El primero es CategoryRepository, es una interfaz que extiende los metodos de la interfaz JpaRepository, ésta última tiene por defecto métodos como findAll() que permite obtener todas los registros.</p> <div class="language- extra-class"><pre class="language-text"><code>    public interface CategoryRepository extends JpaRepository&lt;Category, Integer&gt; {
    }

    @NoRepositoryBean
    public interface JpaRepository&lt;T, ID&gt; extends PagingAndSortingRepository&lt;T, ID&gt;, QueryByExampleExecutor&lt;T&gt; {
        List&lt;T&gt; findAll();

        List&lt;T&gt; findAll(Sort sort);

        List&lt;T&gt; findAllById(Iterable&lt;ID&gt; ids);

        &lt;S extends T&gt; List&lt;S&gt; saveAll(Iterable&lt;S&gt; entities);

        void flush();
        ...
</code></pre></div><p>El repositorio de Products es ProductsRepository el cual a diferencia de CategoryRepository extiende la interfaz PagingAndSortingRepository que permite interactuar con la tabla de Products pero de forma paginada. Aquí se realizó la lógica que cada una los requests, teniendo un total de tres queries.</p> <div class="language- extra-class"><pre class="language-text"><code>    public interface ProductRepository extends PagingAndSortingRepository&lt;Product, Integer&gt; {
        //Query para obtener productos por categoria previniendo sql inyection con parametro indexado y con paginacion
        @Query(value = &quot;select id,name,url_image,price,discount,category from product where category = ?1&quot;,
                countQuery = &quot;select count(*) from product where category = ?1&quot;, nativeQuery = true)
        Page&lt;Product&gt; findByCategory(@Param(&quot;category&quot;) Integer category, Pageable pageable);

        //Query para obtener productos por busqueda de texto previniendo sql inyection con parametro indexado y con paginacion
        @Query(value = &quot;select id,name,url_image,price,discount,category from product where name like CONCAT('%', ?1, '%')&quot;,
                countQuery = &quot;select count(*) from product where name like '%?1%'&quot;, nativeQuery = true)
        Page&lt;Product&gt; findByText(@Param(&quot;text&quot;) String text, Pageable pageable);

        //Query para obtener productos por rango de precios previniendo sql inyection con parametro indexado y con paginacion
        @Query(value = &quot;select id,name,url_image,price,discount,category from product where price between ?1 and ?2&quot;,
                countQuery = &quot;select count(*) from product where price between ?1 and ?2&quot;, nativeQuery = true)
        Page&lt;Product&gt; findByPriceRange(@Param(&quot;minPrice&quot;) Integer minPrice, @Param(&quot;maxPrice&quot;) Integer maxPrice, Pageable pageable);
    }
</code></pre></div><h2 id="servicios"><a href="#servicios" class="header-anchor">#</a> Servicios</h2> <p>El primer servicio, CategoryService, tiene un solo método que permite obtener todas las categorias de la base de datos.</p> <div class="language- extra-class"><pre class="language-text"><code>@Service
    public class CategoryService {
        //Inyeccion de dependencia repositorio
        @Autowired
        CategoryRepository categoryRepository;

        //Obtener todas las categorias
        public List&lt;Category&gt; findAll() {
            return categoryRepository.findAll();
        }

    }
</code></pre></div><p>El segundo servicio, ProductService, posee cuatro métodos los cuales permiten obtener todos los productos,
productos por categoría, productos por filtro de texto y productos por rango de precios, cada uno paginados.</p> <div class="language- extra-class"><pre class="language-text"><code>    @Service
    public class ProductService {
        //Inyeccion de dependencia repositorio
        @Autowired
        ProductRepository productRepository;

        //Obtener todas los productos
        public Page&lt;Product&gt; findAll(Pageable pageable) {
            return productRepository.findAll(pageable);
        }

        //Obtener todos los productos por categoria
        public Page&lt;Product&gt; findAllByCategory(Integer category, Pageable pageable) {
            return productRepository.findByCategory(category, pageable);
        }

        //Obtener todos los productos por texto busqueda
            public Page&lt;Product&gt; findAllByText(String text, Pageable pageable) {
            return productRepository.findByText(text, pageable);
        }

        //Obtener todos los productos por rango de precios
        public Page&lt;Product&gt; findAllByPriceRange(Integer minPrice, Integer maxPrice, Pageable pageable) {
            return productRepository.findByPriceRange(minPrice,maxPrice, pageable);
        }
    }
</code></pre></div><h2 id="rest-controllers"><a href="#rest-controllers" class="header-anchor">#</a> Rest Controllers</h2> <p>CategoryController brinda el endpoint '/categories' tipo get para obtener todos las categorias permitiendo el acceso cross origin a todos los origenes.</p> <div class="language- extra-class"><pre class="language-text"><code>    @RestController
    @RequestMapping(value = &quot;categories&quot;)
    public class CategoryController {
        //Inyeccion de dependencia service
        @Autowired
        private CategoryService categoryService;

        //Allow CrossOrigin a todos los clientes
        @CrossOrigin(origins = &quot;*&quot;)
        //Petición Get con ruta base /categories
        @GetMapping
        public ResponseEntity&lt;List&lt;Category&gt;&gt; getAllCategories() {
            //Obtener todos las categorias desde la base de datos
            List&lt;Category&gt; categories = categoryService.findAll();

            //Retornar un ResponseEnitity con las categorias y el HttpStatus 200 al cliente
            return new ResponseEntity&lt;List&lt;Category&gt;&gt;(categories,null, HttpStatus.OK);
        }
    }
</code></pre></div><p>El ProductController brinda el endpoint 'products' que acepta parametro metros para poder obtener los productos filtrados, se hace uso de una sola función en la cual se valida que parametro está siendo enviado por el cliente para a partir de eso decidir que servicio de products utlizar y devolver una respuesta pagina al cliente.</p> <div class="language- extra-class"><pre class="language-text"><code>    @RestController
    //Direccion base de las peticiones
    @RequestMapping(value = &quot;/products&quot;)
    public class ProductController {
        //Inyeccion dependencia service
        @Autowired
        private ProductService productService;

        //Allow CrossOrigin a todos los clientes
        @CrossOrigin(origins = &quot;*&quot;)
        //Petición Get con ruta base /products con paginacion de 8 elementos por pagina
        @GetMapping
        public ResponseEntity&lt;?&gt; getAllProductsByFilter(@Nullable @RequestParam(&quot;category&quot;) Integer category,
                                                        @Nullable @RequestParam(&quot;text&quot;) String text,
                                                        @Nullable @RequestParam(&quot;minPrice&quot;) Integer minPrice,
                                                        @Nullable @RequestParam(&quot;maxPrice&quot;) Integer maxPrice,
                                                                    @RequestParam(defaultValue = &quot;0&quot;) Integer pageNo,
                                                                    @RequestParam(defaultValue = &quot;8&quot;) Integer pageSize,
                                                                    @RequestParam(defaultValue = &quot;id&quot;) String sortBy) {
            List&lt;Product&gt; products = new ArrayList&lt;&gt;();
            Page&lt;Product&gt; pagedResult;
            Pageable paging = PageRequest.of(pageNo, pageSize, Sort.by(sortBy));
            //Validar que se envíe el parametro category o text o min price
            if (category != null) {
                //Obtener todos los productos por categoria desde la base de datos
                pagedResult = productService.findAllByCategory(category,paging);
            } else if (text != null){
                //Obtener todos los productos filtrado por texto
                pagedResult =  productService.findAllByText(text,paging);
            } else if (minPrice != null) {
                //Obtener todos los productos filtrado por rango de precios
                pagedResult =  productService.findAllByPriceRange(minPrice,maxPrice,paging);
            } else {
                //Obtener todos los productos desde la base de datos
                pagedResult =  productService.findAll(paging);
            }

            //Si pagedReult contiene datos almacenarlo en array list products
            if(pagedResult.hasContent()) {
                products = pagedResult.getContent();
            }

            //Formar un map que contengo los productos y datos de paginacion
            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();
            response.put(&quot;products&quot;, products);
            response.put(&quot;currentPage&quot;, pagedResult.getNumber());
            response.put(&quot;totalItems&quot;, pagedResult.getTotalElements());
            response.put(&quot;totalPages&quot;, pagedResult.getTotalPages());

            //Retornar un ResponseEnitity con los datos de response y el HttpStatus 200 al cliente
            return new ResponseEntity&lt;&gt;(response,null, HttpStatus.OK);
        }

    }
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/documentation.github.io/api/keep-alive.html">
        Keep Alive Strategy
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation.github.io/assets/js/app.c9d3f325.js" defer></script><script src="/documentation.github.io/assets/js/2.7e8b5cf7.js" defer></script><script src="/documentation.github.io/assets/js/9.9177e5a5.js" defer></script>
  </body>
</html>
